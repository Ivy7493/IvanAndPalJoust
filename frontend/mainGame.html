<!DOCTYPE html>
<html>

<head>
    <title>This way up</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="/style.css">
    <link rel="icon" type="image/x-icon" href="/arrow.svg">
    <script src="/socket.io/socket.io.js"></script>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script>
        class Socket {
            constructor() {
                this.lastReceivedGameState = undefined;
                this.players = [];
                this.scoreBoard = [];

                this.gameStateSocket = io(); // actual socket

                this.gameStateSocket.on("state", (state) => {
                    this.lastReceivedGameState = state;
                });

                this.gameStateSocket.on("disconnect", () => {
                    this.lastReceivedGameState = {
                        isDone: true,
                        threshold: 50,
                        closeReason: "",
                        winner: "",
                    };
                });

                this.gameStateSocket.on("connect_error", () => {
                    setTimeout(() => {
                        this.gameStateSocket.connect();
                    }, 1000);
                });

                this.gameStateSocket.on("gameEnd", (sBoard) => { // recieves an array
                    this.scoreBoard = sBoard;
                });

                this.gameStateSocket.on("playerList", (p) => { // recieves an array
                    this.players = p;
                });
            }

            // functions to send data
            setPlayerId(playerId) {
                this.gameStateSocket.emit("playerId", playerId);
            }

            setPlayerLost(playerId) {
                this.gameStateSocket.emit("lost", playerId);
            }

            startGame() {
                this.gameStateSocket.emit("startGame", true);
            }
        }

        var gameStateSocket = new Socket();
    </script>
</head>

<body>
    <iframe onclick="openFullscreen()" id="frame" src="join.html" frameborder="0"></iframe>

</body>
<script src="scripts/mainGame.js"></script>

</html>